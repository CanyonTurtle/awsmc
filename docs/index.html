<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>awsmc pre-alpha prototype</title></head><body><div id="canvas-container"><div id="cartdata" data-cart="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" data-cartlen="4272" data-spritesheet="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAAAQCAYAAAB9XNMLAAAAAXNSR0IArs4c6QAAAd5JREFUWIXFWNt2xCAIHPb0/3/ZPnRNlcxwSbIt5+zDGoQRRkQNQsYYAwDMDACsqBfqRvOZr/Ubkwzbp8XjW2JwDAHA60GHl+YZQdb0OdzYeC8+BVTVY/MYAcYYx28OASLIxEAHyLVoJxjMDLbIokd9qvGregpXYhcARspknxUvZMEtqYL2GHywhe1tjvLbSAhLvNyNk9VfmeGpfGNXPyILhrnQn4K8J5ky2swGbtZucnYcfxWOOXYKsjfmcN8Ge0cmFhbsfxDp1zNblgvP3GhXk+2ybkV5EAXsCMsBO1w6ohivbDVL2km2IBNjbJGhw5t4zj1QUKeSxOfO/qgEypos2qN1q6YIRZdi4psUFmg3/5Ey1qzfZZ/tPrkSm/d2PiVoAbfJpxm1EoZ0CKZ0n5KDydHNi4GDy6SZWcbOuROE3onhjRvdftz/cycE7Os4MVkBvNoP+z7Szy0EJDwwg7GQoWsCs35bsJ1iY1heCnRRKm8Lle/bjjiM/15TZ3eydSkZ04PgtKUSaHbdNjNZkynwjM2CEZQt3Qcl/y5QLSXVt5HKVT3ARN8ypslX1KsWQavrdmVumszANr3pVYKvdLplo+ADAO8uyoYSNlvHVmDHj0/b5W+Vd467uAiO4+83oe+EB/spYGEAAAAASUVORK5CYII="></div><canvas id="screen"></canvas><div id="top"><span id="fpsOut">fps</span>&#160;<a href="https://github.com/CanyonTurtle/awsmc">source</a>&#160;<button type="button" id="fullscreen-btn">Fullscreen</button></div></div><style>#screen{image-rendering:pixelated}body,html{margin:0;width:100%;height:100%;background-color:#fff}#top{position:absolute;top:10px;left:10px;z-index:10;display:inline}#canvas-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center}</style><script>function R(e,t){void 0===t&&(t="+/");for(var n,i=t.charCodeAt(0),o=t.charCodeAt(1),r=new Uint8Array(Math.floor(e.length/4*3)),a=0,c=0,l=new Array(4);c<e.length;){for(var d=0;d<4&&c<e.length;){if((n=e.charCodeAt(c++))>=65&&n<=90)n-=65;else if(n>=97&&n<=122)n-=71;else if(n>=48&&n<=57)n+=4;else if(n==i)n=62;else{if(n!=o)continue;n=63}l[d]=n,d+=1}if(4!=d)for(var f=d;f<4;f++)l[f]=0;r[a+0]=l[0]<<2|l[1]>>4,r[a+1]=(15&l[1])<<4|l[2]>>2,r[a+2]=(3&l[2])<<6|l[3],a+=d-1}return new Uint8Array(r.buffer,0,a)}function b(){if(null==document.fullscreenElement){let e=function(){const e=window.frameElement;if(e){let t=e;t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="99999",t.style.width="100%",t.style.height="100%"}};const t=document.body.requestFullscreen&&document.body.requestFullscreen({navigationUI:"hide"});t?t.catch(e):e()}}var v=function(e){let t=e.memory,n=new Uint8Array(t.buffer,e.config.info_addr,p*B);n.fill(0);let i=0;for(let[t,o]of e.info.player_inputs[0].active_touches.entries()){let[e,t,r]=o;const a=i*B;n[a+1]=e>>8&255,n[a+0]=e,n[a+3]=t>>8&255,n[a+2]=t,n[a+5]=r>>8&255,n[a+4]=r,i+=1}e.info.touch_generation+=1},f=function(e){let t=!1;function n(e,t){e.preventDefault();const n=e.changedTouches;for(let e=0;e<n.length;e++){const i=n[e];o(i.identifier,t,i.clientX,i.clientY)}}function i(e,t){e.preventDefault(),o(-1,t,e.clientX,e.clientY)}function o(t,n,i,o){if(n)return void e.info.player_inputs[0].active_touches.delete(t);const r=document.getElementById("screen"),a=r.getBoundingClientRect(),c=r.width/a.width,l=r.height/a.height,d=Math.floor((i-a.left)*c),f=Math.floor((o-a.top)*l);d<0||d>=r.width||f<0||f>=r.height?e.info.player_inputs[0].active_touches.delete(t):e.info.player_inputs[0].active_touches.set(t,[d,f,e.info.touch_generation])}e.info.player_inputs[0].active_touches=new Map,e.info.touch_generation=0;const r=e=>{n(e,!1)},a=e=>{n(e,!0)},c=e=>{t&&i(e,!1)},l=e=>{t=!0,i(e,!1)},d=e=>{t=!1,i(e,!0)},f=document.getElementById("screen"),u=(e,t)=>{f.removeEventListener(e,t),f.addEventListener(e,t,{passive:!1})};for(let[e,t]of[["touchstart",r],["touchmove",r],["touchend",a],["touchcancel",a],["mousemove",c],["mousedown",l],["mouseup",d]])u(e,t);document.getElementById("fullscreen-btn").addEventListener("click",(e=>{e.preventDefault(),b()}))};async function u(e,t){let n=e.memory;const i=new Uint16Array(n.buffer,t,9);if(e.config={framebuffer_addr:i[1]<<16&4294901760|65535&i[0],info_addr:i[3]<<16&4294901760|65535&i[2],spritesheet_addr:i[5]<<16&4294901760|65535&i[4],logical_width_px:i[6],logical_height_px:i[7],max_n_players:i[8]},console.log(e),0!=e.config.spritesheet_addr){const t=document.getElementById("cartdata").getAttribute("data-spritesheet"),i=new Image;i.src=t,await i.decode();const o=document.createElement("canvas"),r=o.getContext("2d");o.width=i.width,o.height=i.height,r.drawImage(i,0,0);const a=r.getImageData(0,0,i.width,i.height).data;new Uint8Array(n.buffer,e.config.spritesheet_addr,i.width*i.height*F).set(a)}const o=new Uint8Array(n.buffer,e.config.framebuffer_addr,e.config.logical_width_px*e.config.logical_height_px*F),r=document.getElementById("screen");if(r.width=e.config.logical_width_px,r.height=e.config.logical_height_px,!(G=r.getContext("webgl")))return void alert("WebGL not supported");const a=G.createShader(G.VERTEX_SHADER);if(G.shaderSource(a,T),G.compileShader(a),!G.getShaderParameter(a,G.COMPILE_STATUS))return void console.error("Vertex shader compilation error:",G.getShaderInfoLog(a));const c=G.createShader(G.FRAGMENT_SHADER);if(G.shaderSource(c,k),G.compileShader(c),!G.getShaderParameter(c,G.COMPILE_STATUS))return void console.error("Fragment shader compilation error:",G.getShaderInfoLog(c));const l=G.createProgram();G.attachShader(l,a),G.attachShader(l,c),G.linkProgram(l),G.useProgram(l);const d=G.createBuffer();G.bindBuffer(G.ARRAY_BUFFER,d),G.bufferData(G.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,1,1,-1,-1,-1]),G.STATIC_DRAW);const u=G.getAttribLocation(l,"a_position");G.enableVertexAttribArray(u),G.vertexAttribPointer(u,2,G.FLOAT,!1,0,0);const s=G.createTexture();G.bindTexture(G.TEXTURE_2D,s),G.texImage2D(G.TEXTURE_2D,0,G.RGBA,e.config.logical_width_px,e.config.logical_height_px,0,G.RGBA,G.UNSIGNED_BYTE,o),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.NEAREST),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.NEAREST),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,!0),G.uniform1i(G.getUniformLocation(l,"u_texture"),0);const _=G.getUniformLocation(l,"u_resolution");G.uniform2f(_,e.config.logical_width_px,e.config.logical_height_px),f(e)}function h(e){v(e);let t=e.memory,n=(H=new Date).getTime()-x.getTime();Y+=(n-Y)/S,x=H;const i=new Uint8Array(t.buffer,e.config.framebuffer_addr,e.config.logical_width_px*e.config.logical_height_px*F);G.texSubImage2D(G.TEXTURE_2D,0,0,0,e.config.logical_width_px,e.config.logical_height_px,G.RGBA,G.UNSIGNED_BYTE,i),G.clearColor(0,0,0,1),G.clear(G.COLOR_BUFFER_BIT),G.drawArrays(G.TRIANGLE_STRIP,0,6)}async function d(){const e=document.getElementById("cartdata"),t=e.getAttribute("data-cart"),n=(Number(e.getAttribute("data-cartlen")),R(t,void 0)),{instance:i}=await WebAssembly.instantiate(n,{env:{}});return{memory:i.exports.memory,config:{framebuffer_addr:0,info_addr:0,spritesheet_addr:0,logical_width_px:64,logical_height_px:64,max_n_players:0},info:{device_width:64,device_height:64,netplay_player_number:0,player_inputs:[{active_touches:new Map,keys_input:0}],touch_generation:0},exported_functions:{_configure:i.exports.configure,_update:i.exports.update},provided_builtins:{}}}var G,T="\n    attribute vec2 a_position;\n    void main() {\n        gl_Position = vec4(a_position, 0, 1);\n    }\n",k="\n    precision mediump float;\n    uniform sampler2D u_texture;\n    uniform vec2 u_resolution;\n    void main() {\n        vec2 uv = gl_FragCoord.xy / u_resolution;\n        gl_FragColor = texture2D(u_texture, uv);\n    }\n",S=20,Y=0,x=new Date,H=new Date,F=4,p=10,B=6;async function y(){const e=await d(),t=e.exported_functions._configure();await u(e,t),setInterval((()=>{e.exported_functions._update(),h(e)}),16.666666666666668);const n=document.getElementById("screen"),i=e.config.logical_width_px,o=e.config.logical_height_px;function r(){const t=n.parentNode.clientWidth,r=n.parentNode.clientHeight;e.info.device_width=t,e.info.device_height=r;const a=t/i,c=r/o;let l=Math.min(a,c);const d=Math.floor(i*l),f=Math.floor(o*l);n.style.width=d+"px",n.style.height=f+"px"}r(),window.addEventListener("resize",r);var a=document.getElementById("fpsOut");setInterval((function(){a.innerHTML=(1e3/Y).toFixed(1)+" fps"}),1e3)}y()</script></body></html>